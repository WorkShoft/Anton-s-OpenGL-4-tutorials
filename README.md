Code based on Anton Gerdelan's Open 4 book